# 第二章 程序的基本结构

客户端（例如 Web 浏览器）把请求发送给 Web 服务器，Web 服务器再把请求发送给 Flask程序实例。程序实例需要知道对每个 URL 请求运行哪些代码，所以保存了一个 URL 到Python 函数的映射关系。处理 URL 和函数之间关系的程序称为路由。

修饰器是 Python 语言的标准特性，可以使用不同的方式修改函数的行为。惯常用法是使用修饰器把函数注册为事件的处理程序。

视图函数返回的响应可以是包含HTML 的简单字符串，也可以是复杂的表单。

## 程序请求上下文

为了避免大量可有可无的参数把视图函数弄得一团糟，Flask 使用上下文临时把某些对象变为全局可访问。

在 Flask 中有两种上下文：程序上下文和请求上下文

## 请求调度

URL 映射中的 HEAD 、 Options 、 GET 是请求方法，由路由进行处理。Flask 为每个路由都指定了请求方法，这样不同的请求方法发送到相同的 URL 上时，会使用不同的视图函数进行处理。 HEAD 和 OPTIONS 方法由 Flask 自动处理

## 请求钩子

请求钩子使用修饰器实现。Flask 支持以下 4 种钩子：

* before_first_request：注册一个函数，在处理第一个请求之前运行。


* before_request：注册一个函数，在每次请求之前运行。
* after_request：注册一个函数，如果没有未处理的异常抛出，在每次请求之后运行。
* teardown_request：注册一个函数，即使有未处理的异常抛出，也在每次请求之后运行。

## 响应

重定向经常使用 302 状态码表示，指向的地址由 Location 首部提供。重定向响应可以使用3 个值形式的返回值生成，也可在 Response 对象中设定。不过，由于使用频繁，Flask 提供了 redirect() 辅助函数，用于生成这种响应

# 第三者 模板

Flask 使用了一个名为 Jinja2 的强大模板引擎。

默认情况下，Flask 在程序文件夹中的 templates 子文件夹中寻找模板。

 在模板中使用的 {{ name }} 结构表示一个变量，它是一种特殊的占位符，告诉模板引擎这个位置的值从渲染模板时使用的数据中获取。

千万别在不可信的值上使用 safe 过滤器，例如用户在表单中输入的文本。

要想在程序中集成 Bootstrap，显然要对模板做所有必要的改动。不过，更简单的方法是使用一个名为 Flask-Bootstrap 的 Flask 扩展，简化集成的过程。

初始化 Flask-Bootstrap 之后，就可以在程序中使用一个包含所有 Bootstrap 文件的基模板。这个模板利用 Jinja2 的模板继承机制，让程序扩展一个具有基本页面结构的基模板，其中就有用来引入 Bootstrap 的元素。